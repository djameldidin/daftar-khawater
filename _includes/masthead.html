<header class="site-header">
  <div class="masthead__inner-wrap">
    <nav id="site-nav" class="greedy-nav">
      <button class="masthead__menu-toggle">
        <i class="fas fa-bars" aria-hidden="true"></i>
      </button>

      <ul class="visible-links">
        {%- for link in site.data.navigation.main -%}
          {%- if link.children -%}
            <li class="dropdown">
              <a href="#" class="dropdown-toggle">{{ link.title }}</a>
              <ul class="dropdown-menu">
                {%- for child in link.children -%}
                  <li><a href="{{ child.url | relative_url }}">{{ child.title }}</a></li>
                {%- endfor -%}
              </ul>
            </li>
          {%- else -%}
            <li><a href="{{ link.url | relative_url }}">{{ link.title }}</a></li>
          {%- endif -%}
        {%- endfor -%}
      </ul>
    </nav>
  </div>
</header>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const nav = document.querySelector('.greedy-nav');
    const toggleBtn = document.querySelector('.masthead__menu-toggle');

    // 1. تفعيل زر القائمة في الهاتف
    if (toggleBtn) {
      toggleBtn.addEventListener('click', () => {
        nav.classList.toggle('nav-open');
      });
    }

    // 2. تفعيل القوائم المنسدلة عند النقر على كل الأجهزة
    document.querySelectorAll('.dropdown-toggle').forEach(item => {
      item.addEventListener('click', event => {
        event.preventDefault();
        item.parentElement.classList.toggle('open');
      });
    });

    // 3. إغلاق القائمة المنسدلة الرئيسية عند النقر على رابط بداخلها في وضع الهاتف
    document.querySelectorAll('.visible-links a').forEach(link => {
      link.addEventListener('click', () => {
        if (window.innerWidth <= 960 && nav.classList.contains('nav-open')) {
          // لا تغلق القائمة إذا كان الرابط هو زر قائمة فرعية
          if (!link.classList.contains('dropdown-toggle')) {
            nav.classList.remove('nav-open');
          }
        }
      });
    });
  });
</script>